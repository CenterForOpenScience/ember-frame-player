<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/components/exp-lookit-image-audio-base/component.js - ember-lookit-frameplayer</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="https://yui-s.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="https://yui-s.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">
<div id="doc">
    <div id="bd" class="yui3-g">
        <div class="yui3-u-1-5">
            <div id="docs-sidebar" class="sidebar apidocs">
              <h2 style="display:inline;">
              <div>
                <img style="float:right; vertical-align:middle;" src="../assets/css/logo.png" height="70">
                <span>Lookit<br> component<br> docs</span>
              </div>

              </h2>


              <div id="api-list">
                  <div id="api-tabview">
              
                    <div id="api-tabview-panel">
                        <h2 class="off-left">Collections</h2>
                        <ul id="api-modules" class="apis modules">
                            <li class="module-sidebar-exp-player"><a href="../modules/exp-player.html">exp-player</a></li>
                            <li class="module-sidebar-frames"><a href="../modules/frames.html">frames</a></li>
                            <li class="module-sidebar-mixins"><a href="../modules/mixins.html">mixins</a></li>
                            <li class="module-sidebar-randomizers"><a href="../modules/randomizers.html">randomizers</a></li>
                        </ul>
                        <h2 class="off-left">All elements</h2>
                              <div id="api-tabview-filter">
                      <input type="search" id="api-filter" placeholder="Type to filter">
                    </div>
                        <ul id="api-classes" class="apis classes">
                            <li><a href="../classes/Exp-frame-base.html">Exp-frame-base</a></li>
                            <li><a href="../classes/Exp-frame-select.html">Exp-frame-select</a></li>
                            <li><a href="../classes/Exp-lookit-change-detection.html">Exp-lookit-change-detection</a></li>
                            <li><a href="../classes/Exp-lookit-dialogue-page.html">Exp-lookit-dialogue-page</a></li>
                            <li><a href="../classes/Exp-lookit-exit-survey.html">Exp-lookit-exit-survey</a></li>
                            <li><a href="../classes/Exp-lookit-geometry-alternation.html">Exp-lookit-geometry-alternation</a></li>
                            <li><a href="../classes/Exp-lookit-geometry-alternation-open.html">Exp-lookit-geometry-alternation-open</a></li>
                            <li><a href="../classes/Exp-lookit-image-audio-base.html">Exp-lookit-image-audio-base</a></li>
                            <li><a href="../classes/Exp-lookit-instructions.html">Exp-lookit-instructions</a></li>
                            <li><a href="../classes/Exp-lookit-mood-questionnaire.html">Exp-lookit-mood-questionnaire</a></li>
                            <li><a href="../classes/Exp-lookit-observation.html">Exp-lookit-observation</a></li>
                            <li><a href="../classes/Exp-lookit-preferential-looking.html">Exp-lookit-preferential-looking</a></li>
                            <li><a href="../classes/Exp-lookit-single-image.html">Exp-lookit-single-image</a></li>
                            <li><a href="../classes/Exp-lookit-stimuli-preview.html">Exp-lookit-stimuli-preview</a></li>
                            <li><a href="../classes/Exp-lookit-story-page.html">Exp-lookit-story-page</a></li>
                            <li><a href="../classes/Exp-lookit-survey.html">Exp-lookit-survey</a></li>
                            <li><a href="../classes/Exp-lookit-text.html">Exp-lookit-text</a></li>
                            <li><a href="../classes/Exp-lookit-video.html">Exp-lookit-video</a></li>
                            <li><a href="../classes/Exp-lookit-video-assent.html">Exp-lookit-video-assent</a></li>
                            <li><a href="../classes/Exp-lookit-video-consent.html">Exp-lookit-video-consent</a></li>
                            <li><a href="../classes/Exp-lookit-webcam-display.html">Exp-lookit-webcam-display</a></li>
                            <li><a href="../classes/Exp-video-config.html">Exp-video-config</a></li>
                            <li><a href="../classes/Exp-video-config-quality.html">Exp-video-config-quality</a></li>
                            <li><a href="../classes/Expand-assets.html">Expand-assets</a></li>
                            <li><a href="../classes/Full-screen.html">Full-screen</a></li>
                            <li><a href="../classes/Media-reload.html">Media-reload</a></li>
                            <li><a href="../classes/Permute.html">Permute</a></li>
                            <li><a href="../classes/Random-parameter-set.html">Random-parameter-set</a></li>
                            <li><a href="../classes/Select.html">Select</a></li>
                            <li><a href="../classes/Session-record.html">Session-record</a></li>
                            <li><a href="../classes/Video-record.html">Video-record</a></li>
                            <li><a href="../classes/video-recorder.html">video-recorder</a></li>
                        </ul>
                    </div>
              
                  </div>
              </div>
            </div>
        </div>
        <div class="yui3-u-4-5">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app/components/exp-lookit-image-audio-base/component.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Ember from &#x27;ember&#x27;;
import layout from &#x27;./template&#x27;;
import ExpFrameBaseComponent from &#x27;../exp-frame-base/component&#x27;;
import FullScreen from &#x27;../../mixins/full-screen&#x27;;
import VideoRecord from &#x27;../../mixins/video-record&#x27;;
import ExpandAssets from &#x27;../../mixins/expand-assets&#x27;;
import { audioAssetOptions, imageAssetOptions } from &#x27;../../mixins/expand-assets&#x27;;
import { observer } from &#x27;@ember/object&#x27;;

let {
    $
} = Ember;

/**
 * @module exp-player
 * @submodule frames
 */

/**
 * Frame to implement a basic &quot;storybook page&quot; trial, with images placed on the
 * screen within a display area and a sequence of audio files played.
 * Optionally, images may be highlighted at specified times during the audio
 * files.
 *
 * Webcam recording may be turned on or off; if on, the page is not displayed
 * or audio started until recording begins.
 *
 * Frame is displayed fullscreen, but is not paused or otherwise disabled if the
 * user leaves fullscreen. A button appears prompting the user to return to
 * fullscreen mode.
 *
 * The parent may press &#x27;next&#x27; to proceed, or the study may proceed
 * automatically when audio finishes (autoProceed). Optionally, if using autoProceed,
 * the frame may be displayed for a minimum duration, so that e.g. it lasts exactly 10
 * seconds from start of audio even though the audio is only 2 seconds long. If using this
 * feature a progress bar may be displayed.
 *
 * Any number of images may be placed on the screen, and their position
 * specified. (Aspect ratio will be the same as the original image.)
 *
 * This frame is displayed fullscreen; if the frame before it is not, that frame
 * needs to include a manual &quot;next&quot; button so that there&#x27;s a user interaction
 * event to trigger fullscreen mode. (Browsers don&#x27;t allow us to switch to FS
 * without a user event.)

&#x60;&#x60;&#x60;json
 &quot;frames&quot;: {
    &quot;story-intro-1&quot;: {
            &quot;doRecording&quot;: false,
            &quot;autoProceed&quot;: true,
            &quot;baseDir&quot;: &quot;https://s3.amazonaws.com/lookitcontents/ingroupobligations/&quot;,
            &quot;audioTypes&quot;: [&quot;mp3&quot;, &quot;ogg&quot;],
            &quot;parentTextBlock&quot;: {
                &quot;title&quot;: &quot;Parents!&quot;,
                &quot;text&quot;: &quot;some instructions&quot;,
                &quot;emph&quot;: true,
                &quot;css&quot;: {
                    &quot;color&quot;: &quot;red&quot;,
                    &quot;font-size&quot;: &quot;12px&quot;
                }
            },
            &quot;images&quot;: [
                {
                    &quot;id&quot;: &quot;leftA&quot;,
                    &quot;src&quot;: &quot;flurps1.jpg&quot;,
                    &quot;left&quot;: &quot;10&quot;,
                    &quot;width&quot;: &quot;30&quot;,
                    &quot;top&quot;: &quot;34.47&quot;
                },
                {
                    &quot;id&quot;: &quot;rightA&quot;,
                    &quot;src&quot;: &quot;zazzes1.jpg&quot;,
                    &quot;left&quot;: &quot;60&quot;,
                    &quot;width&quot;: &quot;30&quot;,
                    &quot;top&quot;: &quot;34.47&quot;
                }
            ],
            &quot;kind&quot;: &quot;exp-lookit-story-page&quot;,
            &quot;audio&quot;: &quot;intro1&quot;,
            &quot;highlights&quot;: [
                        {&quot;range&quot;: [3.017343,    5.600283], &quot;image&quot;:     &quot;leftA&quot;},
                        {&quot;range&quot;: [5.752911,    8.899402], &quot;image&quot;:     &quot;rightA&quot;}
                    ]
        }
 }

 * &#x60;&#x60;&#x60;
 * @class Exp-lookit-image-audio-base
 * @extends Exp-frame-base
 * @uses Full-screen
 * @uses Video-record
 * @uses Expand-assets
 */

// See https://stackoverflow.com/a/56266358
const isColor = (strColor) =&gt; {
    const s = new Option().style;
    s.color = strColor;
    return s.color !== &#x27;&#x27;;
};

export default ExpFrameBaseComponent.extend(FullScreen, VideoRecord, ExpandAssets, {
    type: &#x27;exp-lookit-story-page&#x27;,
    layout: layout,
    displayFullscreen: true, // force fullscreen for all uses of this component
    fullScreenElementId: &#x27;experiment-player&#x27;, // which element to send fullscreen
    fsButtonID: &#x27;fsButton&#x27;, // ID of button to go to fullscreen

    // Track state of experiment
    completedAudio: false,
    completedAttn: false,
    currentSegment: &#x27;intro&#x27;, // &#x27;calibration&#x27;, &#x27;test&#x27;, &#x27;finalaudio&#x27; (mutually exclusive)
    previousSegment: &#x27;intro&#x27;, // used when pausing/unpausing - refers to segment that study was paused during

    currentAudioIndex: -1, // during initial sequential audio, holds an index into audioSources

    // Override setting in VideoRecord mixin - only use camera if doing recording
    doUseCamera: Ember.computed.alias(&#x27;doRecording&#x27;),
    // Don&#x27;t need to override startRecordingAutomatically as we override the observer
    // whenPossibleToRecord directly.

    pageTimer: null,
    progressTimer: null,
    timerStart: null,
    finishedAllAudio: false,
    minDurationAchieved: false,
    noParentText: false,

    assetsToExpand: {
        &#x27;audio&#x27;: [&#x27;audio&#x27;],
        &#x27;video&#x27;: [],
        &#x27;image&#x27;: [&#x27;images/src&#x27;]
    },

    frameSchemaProperties: {
        // TODO: may need to remove these docs since properties can&#x27;t be used directly by
        // frames inheriting from this one
        /**
         * Whether to do webcam recording (will wait for webcam
         * connection before starting audio if so)
         *
         * @property {Boolean} doRecording
         */
        doRecording: {
            type: &#x27;boolean&#x27;,
            description: &#x27;Whether to do webcam recording (will wait for webcam connection before starting audio if so&#x27;
        },
        /**
         * Whether to proceed automatically after audio (and hide
         * replay/next buttons)
         *
         * @property {Boolean} autoProceed
         */
        autoProceed: {
            type: &#x27;boolean&#x27;,
            description: &#x27;Whether to proceed automatically after audio (and hide replay/next buttons)&#x27;
        },

        /**
         * [Only used if autoProceed is true] Minimum duration of frame in seconds.
         * Frame will auto-proceed after this much time has elapsed and all audio
         * has completed.
         *
         * @property {Number} durationSeconds
         */
        durationSeconds: {
            type: &#x27;number&#x27;,
            description: &#x27;Minimum duration of frame in seconds if autoproceeding&#x27;
        },

        /**
         * [Only used if autoProceed is true and durationSeconds set] Whether to
         * show a progress bar based on durationSeconds in the parent text area.
         *
         * @property {Number} showProgressBar
         */
        showProgressBar: {
            type: &#x27;boolean&#x27;,
            description: &#x27;Whether to show a progress bar based on durationSeconds&#x27;
        },

        /**
         * [Only used if next button is also displayed] Whether to
         * show a previous button to allow the participant to go to the previous frame
         *
         * @property {Number} showPreviousButton
         */
        showPreviousButton: {
            type: &#x27;boolean&#x27;,
            default: true,
            description: &#x27;Whether to show a previous button (used only if showing Next button)&#x27;
        },

        /**
         * Audio file to play at the start of this frame.
         *
         * @property {Object[]} audio audio sources for this frame.
         *
         * This can either be an array of {src: &#x27;url&#x27;, type: &#x27;MIMEtype&#x27;} objects, e.g.
         * listing equivalent .mp3 and .ogg files, or can be a single string &#x60;filename&#x60;
         * which will be expanded based on &#x60;baseDir&#x60; and &#x60;audioTypes&#x60; values (see &#x60;audioTypes&#x60;).
         */
        audio: {
            anyOf: audioAssetOptions,
            description: &#x27;Audio to play as this frame begins&#x27;,
            default: []
        },
        /**
         * Text block to display to parent.  (Each field is optional)
         *
         * @property {Object} parentTextBlock
         *   @param {String} title title to display
         *   @param {String} text paragraph of text
         *   @param {Boolean} emph whether to bold this paragraph
         *   @param {Object} css object specifying any css properties
         *      to apply to this section, and their values - e.g.
         *      {&#x27;color&#x27;: &#x27;red&#x27;, &#x27;font-size&#x27;: &#x27;12px&#x27;}
         */
        parentTextBlock: {
            type: &#x27;object&#x27;,
            properties: {
                title: {
                    type: &#x27;string&#x27;
                },
                text: {
                    type: &#x27;string&#x27;
                },
                emph: {
                    type: &#x27;boolean&#x27;
                },
                css: {
                    type: &#x27;object&#x27;,
                    default: {}
                }
            },
            default: {}
        },
        /**
         * Array of images to display and information about their placement
         *
         * @property {Object[]} images
         *   @param {String} id unique ID for this image
         *   @param {String} src URL of image source. This can be a full
         *     URL, or relative to baseDir (see baseDir).
         *   @param {String} alt alt-text for image in case it doesn&#x27;t load and for
         *     screen readers
         *   @param {String} left left margin, as percentage of story area width
         *   @param {String} width image width, as percentage of story area width
         *   @param {String} top top margin, as percentage of story area height

         */
        images: {
            type: &#x27;array&#x27;,
            items: {
                type: &#x27;object&#x27;,
                properties: {
                    &#x27;id&#x27;: {
                        type: &#x27;string&#x27;
                    },
                    &#x27;src&#x27;: {
                        anyOf: imageAssetOptions
                    },
                    &#x27;alt&#x27;: {
                        type: &#x27;string&#x27;
                    },
                    &#x27;left&#x27;: {
                        type: &#x27;string&#x27;
                    },
                    &#x27;width&#x27;: {
                        type: &#x27;string&#x27;
                    },
                    &#x27;top&#x27;: {
                        type: &#x27;string&#x27;
                    }
                }
            }
        },
        /**
         * Color of background. See https://developer.mozilla.org/en-US/docs/Web/CSS/color_value
         * for acceptable syntax: can use color names (&#x27;blue&#x27;, &#x27;red&#x27;, &#x27;green&#x27;, etc.), or
         * rgb hex values (e.g. &#x27;#800080&#x27; - include the &#x27;#&#x27;)
         *
         * @property {String} backgroundColor
         * @default &#x27;black&#x27;
         */
        backgroundColor: {
            type: &#x27;string&#x27;,
            description: &#x27;Color of background&#x27;,
            default: &#x27;black&#x27;
        },
        /**
         * Color of area where images are shown, if different from overall background.
         * Defaults to backgroundColor if one is provided. See
         * https://developer.mozilla.org/en-US/docs/Web/CSS/color_value
         * for acceptable syntax: can use color names (&#x27;blue&#x27;, &#x27;red&#x27;, &#x27;green&#x27;, etc.), or
         * rgb hex values (e.g. &#x27;#800080&#x27; - include the &#x27;#&#x27;)
         *
         * @property {String} pageColor
         * @default &#x27;white&#x27;
         */
        pageColor: {
            type: &#x27;string&#x27;,
            description: &#x27;Color of image area&#x27;,
            default: &#x27;white&#x27;
        }
    },

    meta: {
        name: &#x27;ExpLookitImageAudio&#x27;,
        description: &#x27;General frame to display images and/or audio&#x27;,
        data: {
            type: &#x27;object&#x27;,
            properties: {
                videoId: {
                    type: &#x27;string&#x27;
                },
                videoList: {
                    type: &#x27;list&#x27;
                },
                /**
                * Array of images used in this frame [same as passed to this frame, but
                * may reflect random assignment for this particular participant]
                * @attribute images
                */
                images: {
                    type: &#x27;array&#x27;
                }
            },
        }
    },

    // Override to do a bit extra when recording (single-frame)
    whenPossibleToRecord: observer(&#x27;recorder.hasCamAccess&#x27;, &#x27;recorderReady&#x27;, function() {
        if (this.get(&#x27;doRecording&#x27;)) {
            var _this = this;
            if (this.get(&#x27;recorder.hasCamAccess&#x27;) &amp;&amp; this.get(&#x27;recorderReady&#x27;)) {
                this.startRecorder().then(() =&gt; {
                    _this.set(&#x27;currentAudioIndex&#x27;, -1);
                    _this.send(&#x27;playNextAudioSegment&#x27;);
                    _this.set(&#x27;recorderReady&#x27;, false);
                    $(&#x27;#waitForVideo&#x27;).hide();
                    $(&#x27;.story-image-container&#x27;).show();
                });
            }
        }
    }),

    // Override to do a bit extra when starting session recorder
    whenPossibleToRecordSession: observer(&#x27;sessionRecorder.hasCamAccess&#x27;, &#x27;sessionRecorderReady&#x27;, function() {
        if (this.get(&#x27;startSessionRecording&#x27;)) {
            var _this = this;
            if (this.get(&#x27;sessionRecorder.hasCamAccess&#x27;) &amp;&amp; this.get(&#x27;sessionRecorderReady&#x27;)) {
                this.startSessionRecorder().then(() =&gt; {
                    _this.set(&#x27;sessionRecorderReady&#x27;, false);
                    _this.set(&#x27;currentAudioIndex&#x27;, -1);
                    _this.send(&#x27;playNextAudioSegment&#x27;);
                    $(&#x27;#waitForVideo&#x27;).hide();
                    $(&#x27;.story-image-container&#x27;).show();
                });
            }
        }
    }),

    actions: {

        // During playing audio
        updateCharacterHighlighting() {

            var highlights = this.get(&#x27;highlights&#x27;);

            if (highlights) {
                var t = $(&#x27;#player-audio&#x27;)[0].currentTime;

                $(&#x27;.story-image-container&#x27;).removeClass(&#x27;highlight&#x27;);

                highlights.forEach(function (h) {
                    if (t &gt; h.range[0] &amp;&amp; t &lt; h.range[1]) {
                        $(&#x27;#&#x27; + h.image).addClass(&#x27;highlight&#x27;);
                    }
                });
            }
        },

        replay() {
            // pause any current audio, and set times to 0
            $(&#x27;audio&#x27;).each(function() {
                this.pause();
                this.currentTime = 0;
            });
            // reset to index -1 as at start of study
            this.set(&#x27;currentAudioIndex&#x27;, -1);
            // restart audio
            this.send(&#x27;playNextAudioSegment&#x27;);
        },

        finish() {
            var _this = this;
            /**
             * Trial is complete and attempting to move to next frame; may wait for recording
             * to catch up before proceeding.
             *
             * @event trialComplete
             */
            this.send(&#x27;setTimeEvent&#x27;, &#x27;trialComplete&#x27;);

            if (this.get(&#x27;doRecording&#x27;)) {
                this.stopRecorder().then(() =&gt; {
                    _this.set(&#x27;stoppedRecording&#x27;, true);
                    _this.send(&#x27;next&#x27;);
                }, () =&gt; {
                    _this.send(&#x27;next&#x27;);
                });
            } else {
                _this.send(&#x27;next&#x27;);
            }
        },

        playNextAudioSegment() {
            this.set(&#x27;currentAudioIndex&#x27;, this.get(&#x27;currentAudioIndex&#x27;) + 1);
            if (this.currentAudioIndex == 0) { // Starting first audio segment: start timer &amp; progress bar
                if (this.get(&#x27;durationSeconds&#x27;)) {
                    let _this = this;
                    /**
                    * Timer for set-duration trial begins
                    *
                    * @event startTimer
                    */
                    this.send(&#x27;setTimeEvent&#x27;, &#x27;startTimer&#x27;);
                    this.set(&#x27;pageTimer&#x27;, window.setTimeout(function() {
                            /**
                            * Timer for set-duration trial ends
                            *
                            * @event endTimer
                            */
                            _this.send(&#x27;setTimeEvent&#x27;, &#x27;endTimer&#x27;);
                            _this.set(&#x27;minDurationAchieved&#x27;, true);
                            if (_this.get(&#x27;finishedAllAudio&#x27;)) {
                                _this.send(&#x27;finish&#x27;);
                            }
                        }, _this.get(&#x27;durationSeconds&#x27;) * 1000));
                    if (this.get(&#x27;showProgressBar&#x27;)) {
                        this.set(&#x27;timerStart&#x27;, new Date().getTime());
                        let timerStart = _this.get(&#x27;timerStart&#x27;);
                        let durationSeconds = _this.get(&#x27;durationSeconds&#x27;);
                        this.set(&#x27;progressTimer&#x27;, window.setInterval(function() {
                            let now = new Date().getTime();
                            var prctDone =  (now - timerStart) / (durationSeconds * 10);
                            $(&#x27;.progress-bar&#x27;).css(&#x27;width&#x27;, prctDone + &#x27;%&#x27;);
                        }, 100));
                    }
                } else {
                    this.set(&#x27;minDurationAchieved&#x27;, true);
                }

                $(&#x27;#player-audio&#x27;)[0].play().then(() =&gt; {
                    /**
                     * When an audio segment starts playing
                     *
                     * @event startAudioSegment
                     * @param {Number} currentAudioIndex the index of the current audio segment, starting from 0
                     */
                    this.send(&#x27;setTimeEvent&#x27;, &#x27;startAudioSegment&#x27;, {&#x27;currentAudioIndex&#x27;: this.currentAudioIndex});
                });
            } else {
                this.set(&#x27;finishedAllAudio&#x27;, true);
                if (this.get(&#x27;autoProceed&#x27;) &amp;&amp; this.get(&#x27;minDurationAchieved&#x27;)) {
                    this.send(&#x27;finish&#x27;);
                } else {
                    $(&#x27;#nextbutton&#x27;).prop(&#x27;disabled&#x27;, false);
                }
            }
        }
    },

    didInsertElement() {

        this._super(...arguments);

        // Apply user-provided CSS to parent text block
        if (Object.keys(this.get(&#x27;parentTextBlock&#x27;)).length) {
            var parentTextBlock = this.get(&#x27;parentTextBlock&#x27;) || {};
            var css = parentTextBlock.css || {};
            $(&#x27;#parenttext&#x27;).css(css);
        } else {
            this.set(&#x27;noParentText&#x27;, true);
            if (this.get(&#x27;autoProceed&#x27;)) {
                this.set(&#x27;noStoryControls&#x27;, true);
            }
        }

        // Apply user-provided CSS to images
        $.each(this.get(&#x27;images_parsed&#x27;), function(idx, image) {
            if (!image.fill) {

                $(&#x27;#&#x27; + image.id).css({&#x27;left&#x27;: &#x60;${image.left}%&#x60;, &#x27;width&#x27;: &#x60;${image.width}%&#x60;, &#x27;top&#x27;: &#x60;${image.top}%&#x60;, &#x27;height&#x27;: &#x60;${image.height}%&#x60;});
            }
        });

        // Apply background colors
        if (isColor(this.get(&#x27;backgroundColor&#x27;))) {
            $(&#x27;div.exp-lookit-image-audio&#x27;).css(&#x27;background-color&#x27;, this.get(&#x27;backgroundColor&#x27;));
        } else {
            console.warn(&#x27;Invalid background color provided; not applying.&#x27;);
        }

        if (isColor(this.get(&#x27;pageColor&#x27;))) {
            $(&#x27;div.exp-lookit-image-audio div#image-area&#x27;).css(&#x27;background-color&#x27;, this.get(&#x27;pageColor&#x27;));
        } else {
            console.warn(&#x27;Invalid page color provided; not applying.&#x27;);
        }

        this.send(&#x27;showFullscreen&#x27;);
        $(&#x27;#nextbutton&#x27;).prop(&#x27;disabled&#x27;, true);

        // If not recording, go to audio right away! Otherwise will be triggered when
        // recording starts.
        if (!(this.get(&#x27;doRecording&#x27;) || this.get(&#x27;startSessionRecording&#x27;))) {
            this.send(&#x27;playNextAudioSegment&#x27;);
        }

    },

    willDestroyElement() {
        window.clearInterval(this.get(&#x27;pageTimer&#x27;));
        window.clearInterval(this.get(&#x27;progressTimer&#x27;));
        this._super(...arguments);
    },

    // Hide story once rendered (as long as story hasn&#x27;t started yet anyway)
    didRender() {
        if ((this.get(&#x27;doRecording&#x27;) || this.get(&#x27;startSessionRecording&#x27;)) &amp;&amp; this.get(&#x27;currentAudioIndex&#x27;) == -1) {
            $(&#x27;.story-image-container&#x27;).hide();
        }
    },

    // Supply image IDs if they&#x27;re missing. This happens BEFORE assignment of
    didReceiveAttrs() {
        this._super(...arguments);
        var N = 1;
        $.each(this.get(&#x27;images&#x27;), function(idx, image) {
            if (!image.hasOwnProperty(&#x27;id&#x27;)) {
                image.id = &#x60;image_${N}&#x60;;
            }
            N++;
        });

    }

});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
